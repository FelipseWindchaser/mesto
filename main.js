(()=>{"use strict";var e={formSelector:".popup__container",inputSelector:".popup__form-field",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_disabled",inputErrorClass:"popup__form-field-error"},t=document.querySelector(".profile__edit-button"),n=".popup_edit-profile",o=document.querySelector(".popup__container"),r=(document.querySelector(n).querySelector(".popup__form-field_type_name"),document.querySelector(n).querySelector(".popup__form-field_type_info"),".popup_add-image"),i=document.querySelector(".profile__add-button"),u=document.querySelector(r).querySelector(".popup__container"),c={},a=document.querySelector(".profile__picture"),s=document.querySelector(".popup__edit-profile-image").querySelector(".popup__container"),l="photos__like-button_active",f={isLoading:"Сохранение...",notLoading:"Сохранить"};function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var h=function(){function e(t,n,o,r,i,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._link=t.link,this._id=t._id,this._likes=t.likes,this._element=document.querySelector(".card-template").content.cloneNode(!0),this._cardImg=this._element.querySelector(".photos__item"),this._openPopup=n,this._cardCaption=this._element.querySelector(".photos__caption"),this._likeBtn=this._element.querySelector(".photos__like-button"),this._likesCounter=this._element.querySelector(".photos__likes-counter"),this._deleteBtn=this._element.querySelector(".photos__delete-button"),this._confirmDeletionPopup=o,this._likeAdd=r,this._likeRemove=i,this._ownerId=u,this._cardOwnerId=t.owner._id}var t,n;return t=e,(n=[{key:"_countLikes",value:function(){this._likesCounter.textContent=this._likes.length}},{key:"generateCard",value:function(){var e=this;return this._cardImg.src=this._link,this._cardImg.alt="Картинка "+this._name,this._cardCaption.textContent=this._name,this._setEventListeners(),this._countLikes(),this._deleteOwnCard(),this._likes.some((function(t){return t._id===e._ownerId}))&&this._likeBtn.classList.add(l),this._element}},{key:"_deleteOwnCard",value:function(){var e=this;this._ownerId===this._cardOwnerId&&(this._deleteBtn.classList.add("photos__delete-button_active"),this._deleteBtn.addEventListener("click",(function(t){return e._confirmDeletionPopup(t.target.closest(".photos__card"),e._id)})))}},{key:"_setEventListeners",value:function(){var e=this;this._likeBtn.addEventListener("click",(function(){return e._handleLike()})),this._cardImg.addEventListener("click",(function(){return e._openPopup({text:e._name,url:e._link})}))}},{key:"_handleLike",value:function(){var e=this;this._likeBtn.classList.contains(l)?this._likeRemove(this._id).then((function(t){e._likes=t.likes,e._countLikes(),e._likeBtn.classList.toggle(l)})).catch((function(e){return console.log(e)})):this._likeAdd(this._id).then((function(t){e._likes=t.likes,e._countLikes(),e._likeBtn.classList.toggle(l)})).catch((function(e){return console.log(e)}))}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var d=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=n,this._validatorSettings=t,this._formSelector=t.formSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._formList=Array.from(document.querySelectorAll(this._formSelector))}var t,n;return t=e,(n=[{key:"_showInputError",value:function(e,t){var n=this._formElement.querySelector(".".concat(e.name,"-error"));e.classList.add(this._inputErrorClass),n.textContent=t}},{key:"_hideInputError",value:function(e){var t=this._formElement.querySelector(".".concat(e.name,"-error"));e.classList.remove(this._inputErrorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_setEventListeners",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"resetValidation",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){e._hideInputError(t)}))}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}])&&_(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var v=function(){function e(t,n){var o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector(n),this._renderer=o}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.append(e)}},{key:"addReversedItem",value:function(e){this._container.prepend(e)}},{key:"loadItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}}])&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popup=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this),this._popupOverlay=this._popup.querySelector(".popup__overlay"),this._closeButton=this._popup.querySelector(".popup__close-button")}var t,n;return t=e,(n=[{key:"openPopup",value:function(){this._popup.classList.add("popup_active"),document.addEventListener("keydown",this._handleEscClose)}},{key:"closePopup",value:function(){this._popup.classList.remove("popup_active"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("mousedown",(function(t){t.target.classList.contains("popup__overlay")&&e.closePopup(),t.target.classList.contains("popup__close-button")&&e.closePopup()}))}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.closePopup()}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=E(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},w.apply(this,arguments)}function E(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function P(e,t){if(t&&("object"===g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O(o);if(r){var n=O(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return P(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e))._imageText=t._popup.querySelector(".popup-picture__caption"),t._imageUrl=t._popup.querySelector(".popup-picture__item"),t}return t=u,(n=[{key:"openPopup",value:function(e){this._imageText.textContent=e.text,this._imageUrl.src=e.url,this._imageUrl.alt="Картинка "+e.text,w(O(u.prototype),"openPopup",this).call(this)}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(b);function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=q(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},I.apply(this,arguments)}function q(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function R(e,t){if(t&&("object"===j(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(o);if(r){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return R(this,e)});function u(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(o=i.call(this,e))._submitForm=t,o._defaultTitle=o._popup.querySelector(".popup__form-field_type_name"),o._defaultInfo=o._popup.querySelector(".popup__form-field_type_info"),o._inputList=o._popup.querySelectorAll(".popup__form-field"),o._formValues={},o._form=o._popup.querySelector(".popup__container"),o._formButton=o._popup.querySelector(".popup__form-button"),o._loadingText=n,o}return t=u,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"_renderLoading",value:function(e){this._formButton.textContent=e?this._loadingText.isLoading:this._loadingText.notLoading}},{key:"setDefaultParams",value:function(e){this._defaultTitle.value=e.name,this._defaultInfo.value=e.description}},{key:"_handleSubmit",value:function(e){var t=this;e.preventDefault(),this._renderLoading(!0),this._submitForm(this._getInputValues()).finally((function(){setTimeout((function(){return t._renderLoading(!1)}),500),t.closePopup()}))}},{key:"setEventListeners",value:function(){I(T(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._handleSubmit.bind(this))}},{key:"closePopup",value:function(){this._form.reset(),I(T(u.prototype),"closePopup",this).call(this)}}])&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(b);function U(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var A=function(){function e(t){var n=t.name,o=t.info,r=t.avatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._title=document.querySelector(n),this._info=document.querySelector(o),this._avatar=document.querySelector(r),this._id=""}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._title.textContent,description:this._info.textContent,avatar:this._avatar,_id:this._id}}},{key:"setUserInfo",value:function(e){this._title.textContent=e.name,this._info.textContent=e.about,this._avatar.src=e.avatar,this._id=e._id}}])&&U(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function V(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function W(){return W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=N(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},W.apply(this,arguments)}function N(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function z(e,t){if(t&&("object"===D(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}var H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=F(o);if(r){var n=F(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return z(this,e)});function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,e))._form=n._popup.querySelector(".popup__container"),n._cardId=null,n._element=null,n._removeCardApi=t,n}return t=u,(n=[{key:"openPopup",value:function(e,t){W(F(u.prototype),"openPopup",this).call(this),this._element=e,this._cardId=t}},{key:"setEventListeners",value:function(){W(F(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._handleSubmit.bind(this))}},{key:"_handleSubmit",value:function(e){e.preventDefault(),this._removeCardApi(this._cardId).then((function(e){return console.log(e)})).catch((function(e){return console.log(e)})),this._element.remove(),this.closePopup()}}])&&V(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(b);function J(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var M=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers,this._token=t.headers.authorization}var t,n;return t=e,(n=[{key:"_fetchGet",value:function(e){return fetch("".concat(this._baseUrl,"/").concat(e),{headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"getInitialCards",value:function(){return this._fetchGet("cards")}},{key:"getUserInfo",value:function(){return this._fetchGet("users/me")}},{key:"_fetchWithBody",value:function(e,t,n){return fetch("".concat(this._baseUrl,"/").concat(e),{method:n,headers:this._headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"editProfileInfo",value:function(e){return this._fetchWithBody("users/me",{name:e["profile-name"],about:e["profile-info"]},"PATCH")}},{key:"editProfileImage",value:function(e){return this._fetchWithBody("users/me/avatar",{avatar:e},"PATCH")}},{key:"addNewCards",value:function(e){return this._fetchWithBody("cards",e,"POST")}},{key:"_fetchWithoutBody",value:function(e,t){return fetch("".concat(this._baseUrl,"/").concat(e),{method:t,headers:this._headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}},{key:"addLike",value:function(e){return this._fetchWithoutBody("cards/".concat(e,"/likes"),"PUT")}},{key:"removeLike",value:function(e){return this._fetchWithoutBody("cards/".concat(e,"/likes"),"DELETE")}},{key:"removeCard",value:function(e){return this._fetchWithoutBody("cards/".concat(e),"DELETE")}}])&&J(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-38",headers:{authorization:"c9fb0e1a-fc76-4d2f-8a74-6a3510bead6d","Content-Type":"application/json"}}),K=new v({renderer:function(e){K.addItem(X(e))}},".photos");M.getUserInfo().then((function(e){M.getInitialCards().then((function(e){K.loadItems(e)})).catch((function(e){return console.log(e)})),Y.setUserInfo(e)})).catch((function(e){return console.log(e)}));var Q=new L(".popup-picture");function X(e){return new h(e,(function(e){return Q.openPopup(e)}),(function(e,t){return Z.openPopup(e,t)}),(function(e){return M.addLike(e)}),(function(e){return M.removeLike(e)}),Y.getUserInfo()._id).generateCard()}Q.setEventListeners();var Y=new A({name:".profile__title",info:".profile__subtitle",avatar:".profile__picture"}),Z=new H(".popup_delete-card",(function(e){return M.removeCard(e)}));Z.setEventListeners();var $=new x(n,(function(e){return M.editProfileInfo(e).then((function(e){return Y.setUserInfo(e)})).catch((function(e){return console.log(e)}))}),f);$.setEventListeners();var ee=new x(".popup__edit-profile-image",(function(e){return M.editProfileImage(e["profile-url"]).then((function(e){return Y.setUserInfo(e)})).catch((function(e){return console.log(e)}))}),f);ee.setEventListeners();var te=new x(r,(function(e){return M.addNewCards({name:e["image-name"],link:e["image-url"]}).then((function(e){K.addReversedItem(X(e))})).catch((function(e){return console.log(e)}))}),{isLoading:"Создание...",notLoading:"Создать"});te.setEventListeners(),Array.from(document.querySelectorAll(".popup__container")).forEach((function(t){var n=new d(e,t),o=t.getAttribute("name");c[o]=n,n.enableValidation()})),i.addEventListener("click",(function(){u.reset(),c[u.getAttribute("name")].resetValidation(),te.openPopup()})),t.addEventListener("click",(function(){$.setDefaultParams(Y.getUserInfo()),c[o.getAttribute("name")].resetValidation(),$.openPopup()})),a.addEventListener("click",(function(){c[s.getAttribute("name")].resetValidation(),ee.openPopup()}))})();